<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Cat√©gorie - Wiki SGPI</title>
    <link rel="stylesheet" href="style.css">
</head>
<script>
    const API_URL = 'https://backend-wiki-zaxy.onrender.com'
 </script>
<body class="dark-mode">

    <header>
        <div class="header-content">
            <h1><a href="index.html">üìö Wiki SGPI</a></h1>
            <div class="header-actions">
                <a href="account.html" style="margin-right: 16px; padding: 8px 16px; background: var(--bg-hover); border: 1px solid var(--border); border-radius: 6px; cursor: pointer; color: var(--text-primary); text-decoration: none; font-size: 0.9rem;">Mon compte</a>
                <button id="logout-btn" class="logout-btn">D√©connexion</button>
                <button id="theme-toggle" aria-label="Changer de th√®me">
                    <span class="icon-sun">‚òÄÔ∏è</span>
                    <span class="icon-moon">üåô</span>
                </button>
                <button id="menu-toggle" class="mobile-only" aria-label="Menu">‚ò∞</button>
            </div>
        </div>
    </header>

    <div class="container">
        
        <aside id="sidebar" class="sidebar">
            <div class="sidebar-header">
                <input type="text" id="search" placeholder="üîç Rechercher..." autocomplete="off">
            </div>

            <nav class="nav-categories">
                <h3>Cat√©gories</h3>
                <ul id="sidebar-categories">
                    <li style="text-align: center; color: var(--text-secondary);">Chargement...</li>
                </ul>
            </nav>

            <div class="toc" id="toc" style="display: none;">
                <h3>Sur cette page</h3>
                <ul id="toc-list"></ul>
            </div>
        </aside>

        <main class="main-content category-page">
            
            <div id="loading" style="text-align: center; padding: 60px; color: var(--text-secondary);">
                <div style="font-size: 3rem; margin-bottom: 20px;">‚è≥</div>
                <p>Chargement...</p>
            </div>

            <div id="error" style="display: none; text-align: center; padding: 60px;">
                <div style="font-size: 3rem; margin-bottom: 20px;">‚ùå</div>
                <h2 style="color: var(--text-primary); margin-bottom: 10px;">Cat√©gorie introuvable</h2>
                <p style="color: var(--text-secondary); margin-bottom: 20px;">Cette cat√©gorie n'existe pas ou a √©t√© supprim√©e.</p>
                <a href="index.html" style="display: inline-block; padding: 12px 24px; background: var(--accent); color: white; text-decoration: none; border-radius: 8px; font-weight: 600;">‚Üê Retour √† l'accueil</a>
            </div>

            <div id="content" style="display: none;">
                <h2 id="category-title"></h2>
                <div id="sections-container"></div>
            </div>

        </main>

    </div>

    <button id="back-to-top" class="back-to-top" aria-label="Retour en haut">‚Üë</button>

    <footer>
        <p>¬© 2026 SGPI - Wiki √† usage priv√© | R√©serv√© aux membres Discord</p>
        <p>Derni√®re mise √† jour : F√©vrier 2026</p>
    </footer>

    <script src="script.js"></script>
    
    <script>
        
        // R√©cup√©rer le slug depuis l'URL
        const urlParams = new URLSearchParams(window.location.search);
        const slug = urlParams.get('slug');
        
        if (!slug) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error').style.display = 'block';
        } else {
            loadCategory(slug);
        }
        
        // Charger les cat√©gories pour la sidebar
        async function loadSidebarCategories() {
            try {
                const res = await fetch(`${API_URL}/api/categories`);
                const data = await res.json();
                
                if (res.ok && data.categories) {
                    const ul = document.getElementById('sidebar-categories');
                    ul.innerHTML = data.categories.map(cat => {
                        const isActive = cat.slug === slug ? 'class="active"' : '';
                        return `<li><a href="category.html?slug=${cat.slug}" ${isActive}>${cat.emoji} ${cat.name}</a></li>`;
                    }).join('');
                }
            } catch (err) {
                console.error('Erreur chargement sidebar:', err);
            }
        }
        
        // Charger la cat√©gorie
        async function loadCategory(slug) {
            try {
                const res = await fetch(`${API_URL}/api/categories/${slug}`);
                const data = await res.json();
                
                if (!res.ok) {
                    throw new Error(data.error);
                }
                
                const category = data.category;
                
                // Titre de la page
                document.getElementById('page-title').textContent = `${category.emoji} ${category.name} - Wiki SGPI`;
                document.getElementById('category-title').innerHTML = `${category.emoji} ${category.name}`;
                
                // G√©n√©rer les sections
                const sectionsContainer = document.getElementById('sections-container');
                
                if (!category.sections || category.sections.length === 0) {
                    sectionsContainer.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 40px;">Aucune section dans cette cat√©gorie. <a href="admin.html?admin_key=adminsgpi">Ajouter du contenu</a></p>';
                } else {
                    sectionsContainer.innerHTML = category.sections.map(section => {
                        const links = section.links || [];
                        
                        return `
                            <section id="section-${section.id}">
                                <h3>${section.name}</h3>
                                ${links.length === 0 ? 
                                    '<p style="color: var(--text-secondary); font-style: italic;">Aucun lien dans cette section.</p>' :
                                    `<ul class="resource-list">
                                        ${links.map(link => `
                                            <li>
                                                <a href="${link.url}" target="_blank" rel="noopener noreferrer">${link.name}</a>
                                                ${link.badge ? ` ${link.badge}` : ''}
                                                ${link.description ? ` - ${link.description}` : ''}
                                            </li>
                                        `).join('')}
                                    </ul>`
                                }
                            </section>
                        `;
                    }).join('');
                    
                    // G√©n√©rer la table des mati√®res
                    const tocList = document.getElementById('toc-list');
                    tocList.innerHTML = category.sections.map(section => 
                        `<li><a href="#section-${section.id}">${section.name}</a></li>`
                    ).join('');
                    document.getElementById('toc').style.display = 'block';
                }
                
                // Afficher le contenu
                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').style.display = 'block';
                
            } catch (err) {
                console.error('Erreur chargement cat√©gorie:', err);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
            }
        }
        
        loadSidebarCategories();
    </script>
</body>
</html>
